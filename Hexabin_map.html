<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>India Hexbin Map</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-hexbin@0.2.2/build/d3-hexbin.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/topojson@3"></script>
<style>
body {
  font-family: Arial;
}
.hexagon {
  stroke: #fff;
  stroke-width: 1px;
}
</style>
</head>
<body>

<svg width="900" height="700"></svg>

<script>

const width = 900;
const height = 700;

const svg = d3.select("svg");

const projection = d3.geoMercator()
    .center([82.8, 22.5]) // India center
    .scale(1000)
    .translate([width / 2, height / 2]);

const path = d3.geoPath().projection(projection);

// Load India GeoJSON
d3.json("https://raw.githubusercontent.com/geohacker/india/master/state/india_telengana.geojson")
.then(function(india) {

    // Draw India map
    svg.append("g")
      .selectAll("path")
      .data(india.features)
      .enter()
      .append("path")
      .attr("d", path)
      .attr("fill", "#eee")
      .attr("stroke", "#999");

    // Load CSV
    d3.csv("data.csv").then(function(data) {

        data.forEach(d => {
            const coords = projection([+d.lon, +d.lat]);
            d.x = coords[0];
            d.y = coords[1];
        });

        const hexbin = d3.hexbin()
            .x(d => d.x)
            .y(d => d.y)
            .radius(20)
            .extent([[0, 0], [width, height]]);

        const bins = hexbin(data);

        const color = d3.scaleSequential(d3.interpolateReds)
            .domain([0, d3.max(bins, d => d.length)]);

        svg.append("g")
          .selectAll(".hexagon")
          .data(bins)
          .enter().append("path")
          .attr("class", "hexagon")
          .attr("d", d => "M" + d.x + "," + d.y + hexbin.hexagon())
          .attr("fill", d => color(d.length))
          .attr("opacity", 0.8);

    });

});

</script>

</body>
</html>